# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü (Nested Tables)

## üìã –†–µ–∑—é–º–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –≤ —Å–∏—Å—Ç–µ–º–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –ß–¢–ó –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:
- ‚úÖ DOCX ‚Üí Markdown (reverse converter)
- ‚úÖ Markdown ‚Üí DOCX (forward converter)
- ‚úÖ Round-trip —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (MD ‚Üí DOCX ‚Üí MD)

## üéØ –ó–∞–¥–∞—á–∏

### 1. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
- [x] –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –∏–∑ DOCX (w:tbl –≤–Ω—É—Ç—Ä–∏ w:tc)
- [x] –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Markdown pipe-—Ç–∞–±–ª–∏—Ü—ã
- [x] –ü–∞—Ä—Å–∏–Ω–≥ Markdown —Ç–∞–±–ª–∏—Ü –≤ scenario –±–ª–æ–∫–∞—Ö
- [x] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –≤ DOCX XML
- [x] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã (–±–µ–∑ –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏—è –≤ code blocks)
- [x] Blank lines –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è Markdown —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ xml:space="preserve" –≤ XML-–ø–∞—Ä—Å–µ—Ä–µ
- [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤ –º–µ–∂–¥—É text runs
- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ "–¢–∞–±–ª–∏—Ü–∞6" ‚Üí "–¢–∞–±–ª–∏—Ü–∞ 6"

### 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ <br>
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HTML-—É–∑–ª–æ–≤ –≤ Markdown –ø–∞—Ä—Å–µ—Ä–µ
- [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ <br> —á–µ—Ä–µ–∑ round-trip
- [x] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ –≤ DOCX —è—á–µ–π–∫–∞—Ö

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**Full Round-Trip Test**: Original DOCX ‚Üí MD ‚Üí DOCX ‚Üí MD

```
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- –°—Ç—Ä–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–æ: ~3% (30 —É–¥–∞–ª–µ–Ω–∏–π, 24 –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–∑ ~160 —Å—Ç—Ä–æ–∫)
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ‚úÖ 100% —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã: ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã (–¢–∞–±–ª–∏—Ü–∞ 2, –¢–∞–±–ª–∏—Ü–∞ 8)
- –¢–µ–≥–∏ <br>: ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- –ü—Ä–æ–±–µ–ª—ã: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
```

**–ú–∏–Ω–æ—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** (–Ω–µ—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ):
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è trailing spaces
- –ü–æ—Ç–µ—Ä—è –Ω—É–º–µ—Ä–∞—Ü–∏–∏ "1." –≤ –Ω–∞—á–∞–ª–µ scenario
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è whitespace –≤–æ–∫—Ä—É–≥ —Ç–∞–±–ª–∏—Ü

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### src/reverse/recognizers/element-extractor.js
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –∏–∑ —è—á–µ–µ–∫
- `extractTableCell()` —Ç–µ–ø–µ—Ä—å –∏–∑–≤–ª–µ–∫–∞–µ—Ç `w:tbl` —ç–ª–µ–º–µ–Ω—Ç—ã

### src/reverse/recognizers/tables/table-to-markdown.js (NEW)
- –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü –≤ Markdown —Ñ–æ—Ä–º–∞—Ç
- `tableToMarkdownIndented()` - —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏
- `escapeTableCell()` - —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

### src/reverse/recognizers/tables/function-table.js
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –≤ scenario —è—á–µ–π–∫–∞—Ö
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Markdown —Å baseIndent=0 (–∏–∑–±–µ–≥–∞–Ω–∏–µ code blocks)
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ blank lines –ø–æ Markdown —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

### src/utils/markdown-table-parser.js (NEW)
- –ü–∞—Ä—Å–∏–Ω–≥ Markdown —Ç–∞–±–ª–∏—Ü –∏–∑ —Ç–µ–∫—Å—Ç–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –º–µ–∂–¥—É header –∏ separator
- `parseMarkdownTable()`, `parseTableRow()`, `isTableSeparator()`

### src/builders/function-table-builder.js
- –ü–∞—Ä—Å–∏–Ω–≥ Markdown —Ç–∞–±–ª–∏—Ü –≤ scenario –±–ª–æ–∫–∞—Ö
- `buildNestedTable()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –≤ DOCX
- –û–±—Ä–∞–±–æ—Ç–∫–∞ <br> —Ç–µ–≥–æ–≤ - split –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã

### src/parser/directives.js
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ HTML-—É–∑–ª–æ–≤ –≤ `extractMarkdownText()`
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ <br> –∏ –¥—Ä—É–≥–∏—Ö inline HTML —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü –≤ code blocks

### src/reverse/reader/xml-parser.js
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Ç—Ä–∏–±—É—Ç–∞ xml:space="preserve"
- `parseContent()` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä preserveSpace
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ text nodes —Å preserve

## üìù –ö–æ–º–º–∏—Ç—ã

```
80177a1 chore: organize debug scripts and cleanup temporary files
dbc1386 fix: preserve <br> tags in nested table cells during round-trip
bcbf0cc fix: preserve spaces in Word text runs with xml:space="preserve"
9e1fe7e feat: add blank line after nested tables for Markdown compliance
1960d08 fix: remove extra indentation from nested tables in scenario
00140fc fix: correct Markdown table formatting with blank lines
00224d2 feat: add nested tables support for function-table scenarios
aa0c56e docs: add comprehensive documentation for reverse converter
c8488f0 feat: enhance diff mode with better algorithm and statistics
d82e8ae feat: implement strict mode validation for reverse converter
9af4ec4 feat: support documents with incomplete structure
df4f892 fix: resolve double images/ path issue and verify image extraction
```

## üõ†Ô∏è –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

–í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `debug/` —Å–æ–±—Ä–∞–Ω—ã –ø–æ–ª–µ–∑–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:

- **analyze-heading-runs.js** - –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã runs –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
- **debug-br-extraction.js** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è <br> —Ç–µ–≥–æ–≤
- **find-nested-tables.js** - –ø–æ–∏—Å–∫ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –≤ DOCX
- **check-raw-xml.js** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—ã—Ä–æ–≥–æ XML

–û—Ç—á–µ—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ `debug/reports/`.

## üéì –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏

### 1. Markdown –æ—Ç—Å—Ç—É–ø—ã –∏ code blocks
- 4+ –ø—Ä–æ–±–µ–ª–∞ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç —Ç–∞–±–ª–∏—Ü—ã –≤ code blocks
- YAML `scenario: |` —É–∂–µ –¥–æ–±–∞–≤–ª—è–µ—Ç 2-–ø—Ä–æ–±–µ–ª—å–Ω—ã–π –æ—Ç—Å—Ç—É–ø
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å baseIndent=0

### 2. Markdown —Ç–∞–±–ª–∏—Ü—ã —Ç—Ä–µ–±—É—é—Ç blank lines
- –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–µ—Ä–µ–¥ —Ç–∞–±–ª–∏—Ü–µ–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞
- –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ—Å–ª–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
- –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –º–µ–∂–¥—É header –∏ separator –¥–æ–ø—É—Å—Ç–∏–º—ã

### 3. Word text runs –∏ –ø—Ä–æ–±–µ–ª—ã
- –ü—Ä–æ–±–µ–ª—ã —á–∞—Å—Ç–æ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö runs
- xml:space="preserve" —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∑–Ω–∞—á–∏–º—ã–µ –ø—Ä–æ–±–µ–ª—ã
- .trim() –Ω–∞ text nodes –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –≤–∞–∂–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã

### 4. HTML –≤ Markdown
- remark –ø–∞—Ä—Å–∏—Ç <br> –∫–∞–∫ html-—É–∑–ª—ã
- –ë–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏ html-—É–∑–ª—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
- Inline HTML –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è as-is

## üöÄ –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ):
- [ ] –ê–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ "6.–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ" ‚Üí "6. –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ"
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ "1." –≤ –Ω–∞—á–∞–ª–µ scenario
- [ ] –ë–æ–ª–µ–µ —É–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ trailing spaces
- [ ] Diff mode –º–µ–∂–¥—É Markdown —Ñ–∞–π–ª–∞–º–∏

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- Round-trip —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
- –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- –ú–∏–Ω–æ—Ä–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã
