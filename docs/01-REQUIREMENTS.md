# Требования к системе генерации ЧТЗ

## 1. Общее описание

### 1.1 Назначение системы

Система **CHTZ Generator** предназначена для автоматизации создания документов "Частное техническое задание" (ЧТЗ) в формате Microsoft Word (.docx) на основе исходных файлов в формате Markdown.

### 1.2 Цели системы

| Цель | Описание |
|------|----------|
| Упрощение создания | Авторы пишут в простом текстовом формате Markdown |
| Версионирование | Markdown-файлы легко хранить в Git с осмысленными diff |
| Единообразие | Все документы соответствуют корпоративному шаблону |
| Автоматизация | Генерация docx без ручного форматирования |
| ИИ-совместимость | Формат легко генерируется языковыми моделями |

### 1.3 Пользователи системы

1. **Бизнес-аналитики** — пишут ЧТЗ в Markdown
2. **Разработчики** — поддерживают и расширяют генератор
3. **ИИ-ассистенты** — генерируют Markdown по описанию задачи

---

## 2. Функциональные требования

### 2.1 Входные данные

#### FR-001: Формат исходного файла
- **Описание**: Система должна принимать файлы в формате Markdown с YAML Front Matter
- **Расширение файла**: `.md`
- **Кодировка**: UTF-8

#### FR-002: Структура YAML Front Matter
Система должна поддерживать следующие поля метаданных:

```yaml
---
type: chtz                    # Тип документа (обязательно)
version: "1.0"                # Версия документа

metadata:
  shortName: string           # Краткое название изменения
  consultant:
    name: string              # ФИО консультанта
    email: string             # Email консультанта
  organization: string        # Наименование организации заказчика
  itSolutions: string[]       # Список ИТ-решений
  itSystems: string[]         # Список ИТ-систем
  processKT: boolean          # Обработка данных КТ
  processPDn: boolean         # Обработка данных ПДн
  createdDate: string         # Дата создания (DD.MM.YYYY)

history:                      # История изменений
  - version: string
    date: string
    comment: string
    author: string

relatedDocs:                  # Связанные документы
  - name: string
    version: string
    date: string
---
```

#### FR-003: Поддерживаемые элементы Markdown

| Элемент | Синтаксис | Описание |
|---------|-----------|----------|
| Заголовки | `# H1`, `## H2`, `### H3` | До 3 уровней вложенности |
| Параграфы | Текст с пустой строкой | Обычный текст |
| Жирный | `**текст**` | Полужирное начертание |
| Курсив | `*текст*` | Курсивное начертание |
| Маркированный список | `- пункт` | Буллеты до 3 уровней |
| Нумерованный список | `1. пункт` | Нумерация до 3 уровней |
| Таблицы | GFM-таблицы | Стандартные Markdown-таблицы |
| Изображения | `![alt](path)` | Ссылки на локальные файлы |
| Ссылки | `[текст](url)` | Внешние гиперссылки |
| Внутренние ссылки | `[текст](#anchor)` | Перекрёстные ссылки |

#### FR-004: Специальные директивы

Система должна поддерживать расширенный синтаксис директив:

```markdown
:::terms
| Термин | Определение |
:::

:::changes-table
| Как есть | Как будет |
:::

:::function-table{#id}
function: Название функции
task: TASK-123
taskUrl: https://...
scenario: |
  Многострочное описание сценария
:::

:::note{type="warning"}
Текст предупреждения
:::

:::empty-section
Текст пустого раздела
:::
```

#### FR-005: Изображения
- Поддержка форматов: PNG, JPEG, GIF
- Относительные пути: `./images/image.png`
- Атрибут размера: `![alt](path){width="70%"}`

### 2.2 Выходные данные

#### FR-006: Формат выходного файла
- **Формат**: Microsoft Word (.docx)
- **Совместимость**: Word 2016 и новее
- **Стандарт**: Office Open XML (OOXML)

#### FR-007: Соответствие шаблону
Выходной документ должен точно соответствовать корпоративному шаблону:
- Колонтитулы с логотипом
- Стили заголовков (Arial, размеры по шаблону)
- Стили текста (Times New Roman, 12pt)
- Форматирование таблиц
- Нумерация разделов

#### FR-008: Структура выходного документа

1. Титульная шапка (таблица метаданных)
2. История изменений
3. Связанные документы
4. Оглавление
5. Основные разделы (1-10)
6. Приложения

### 2.3 Обработка ошибок

#### FR-009: Валидация входных данных
- Проверка обязательных полей YAML
- Проверка существования изображений
- Проверка синтаксиса директив
- Понятные сообщения об ошибках

#### FR-010: Логирование
- Вывод прогресса генерации
- Предупреждения о потенциальных проблемах
- Детальные сообщения при ошибках

---

## 3. Нефункциональные требования

### 3.1 Производительность

#### NFR-001: Время генерации
- Документ до 50 страниц: < 5 секунд
- Документ до 100 страниц: < 15 секунд

#### NFR-002: Потребление памяти
- Максимум 512 MB RAM при генерации

### 3.2 Надёжность

#### NFR-003: Обработка некорректных данных
- Система не должна аварийно завершаться при ошибках во входных данных
- Все ошибки должны быть перехвачены и описаны

### 3.3 Переносимость

#### NFR-004: Платформы
- Windows 10/11
- macOS 12+
- Linux (Ubuntu 20.04+)

#### NFR-005: Зависимости
- Node.js 18+
- Минимум внешних зависимостей

### 3.4 Расширяемость

#### NFR-006: Модульность
- Возможность добавления новых директив
- Возможность кастомизации стилей
- Поддержка разных шаблонов

### 3.5 Удобство использования

#### NFR-007: Интерфейс командной строки
```bash
chtz-generate input.md -o output.docx -t template.docx
```

#### NFR-008: Документация
- README с быстрым стартом
- Справочник по формату Markdown
- Примеры документов

---

## 4. Ограничения

### 4.1 Технические ограничения

| Ограничение | Описание |
|-------------|----------|
| Формат таблиц | Только простые таблицы (без объединения ячеек в Markdown) |
| Изображения | Только локальные файлы, без URL |
| Формулы | Не поддерживаются |
| Диаграммы | Только как изображения |

### 4.2 Бизнес-ограничения

- Система предназначена для внутреннего использования
- Шаблон может быть адаптирован для любой организации

---

## 5. Приёмочные критерии

### AC-001: Базовая генерация
- [ ] Markdown с YAML конвертируется в docx без ошибок
- [ ] Все заголовки имеют корректные стили
- [ ] Списки форматируются правильно

### AC-002: Специальные блоки
- [ ] Таблица терминов генерируется корректно
- [ ] Функциональные таблицы соответствуют шаблону
- [ ] Таблица "как есть/как будет" форматируется правильно

### AC-003: Изображения
- [ ] Изображения вставляются в документ
- [ ] Размеры изображений соблюдаются
- [ ] Подписи к изображениям отображаются

### AC-004: Колонтитулы
- [ ] Логотип отображается в колонтитуле
- [ ] Нумерация страниц работает
- [ ] Название документа в колонтитуле

### AC-005: Метаданные
- [ ] Шапка документа заполняется из YAML
- [ ] История изменений отображается
- [ ] Связанные документы перечислены

---

## 6. Глоссарий

| Термин | Определение |
|--------|-------------|
| ЧТЗ | Частное техническое задание — документ с требованиями к изменению ИТ-системы |
| Markdown | Облегчённый язык разметки для форматирования текста |
| YAML | Формат сериализации данных (Yet Another Markup Language) |
| Front Matter | Блок метаданных в начале файла, отделённый `---` |
| Директива | Специальный блок с расширенным синтаксисом `:::name` |
| docx | Формат документов Microsoft Word (Office Open XML) |
