---
type: chtz
version: "2.0"

metadata:
  shortName: "Внедрение функции электронного подписания документов"
  consultant:
    name: "Иванов Иван Иванович"
    email: "ivanov@example.com"
  organization: "ООО «Пример»"
  itSolutions:
    - "Система управления документами"
    - "Корпоративный портал"
  itSystems:
    - "СЭД «Документооборот»"
    - "ЕСМ Портал"
  processKT: false
  processPDn: true
  createdDate: "17.01.2025"

history:
  - version: "1.0"
    date: "10.01.2025"
    comment: "Первоначальная версия документа"
    author: "Иванов И.И."
  - version: "2.0"
    date: "17.01.2025"
    comment: "Добавлены требования к интерфейсу"
    author: "Петров П.П."

relatedDocs:
  - name: "Техническое задание на СЭД"
    version: "3.5"
    date: "01.12.2024"
  - name: "Регламент электронного документооборота"
    version: "1.2"
    date: "15.11.2024"
---

# 1. Термины, определения и сокращения

В настоящем документе используются следующие термины и сокращения:

:::terms
| Термин | Определение |
|--------|-------------|
| ЧТЗ | Частное техническое задание — документ, описывающий требования к изменению информационной системы |
| СЭД | Система электронного документооборота |
| ЭП | Электронная подпись |
| ПДн | Персональные данные |
| ИС | Информационная система |
| API | Application Programming Interface — интерфейс программирования приложений |
| REST | Representational State Transfer — архитектурный стиль взаимодействия |
:::

# 2. Исходные данные

## 2.1 Описание текущей ситуации

В настоящее время процесс подписания документов осуществляется следующим образом:

1. Пользователь формирует документ в системе
2. Документ отправляется на согласование по электронной почте
3. Согласующие лица распечатывают документ
4. Подписание осуществляется на бумажном носителе
5. Скан подписанного документа загружается обратно в систему

**Проблемы текущего процесса:**

- Длительное время согласования (до 5 рабочих дней)
- Необходимость физического присутствия подписанта
- Затраты на печать и хранение бумажных документов
- Риск потери документов

## 2.2 Цели изменения

Целью данного изменения является:

- Сокращение времени согласования документов до 1 рабочего дня
- Исключение необходимости печати документов
- Обеспечение юридической значимости электронных документов
- Повышение прозрачности процесса согласования

# 3. Описание требований

## 3.1 Функция подписания документа

:::function-table{#func-sign}
function: Электронное подписание документа с использованием квалифицированной электронной подписи
task: DOC-1234
taskUrl: https://task.example.com/browse/DOC-1234
scenario: |
  **Предусловия:**
  - Пользователь авторизован в системе
  - У пользователя есть действующий сертификат ЭП
  - Документ находится в статусе "На подписании"

  **Основной сценарий:**
  1. Пользователь открывает карточку документа
  2. Система отображает кнопку "Подписать"
  3. Пользователь нажимает кнопку "Подписать"
  4. Система запрашивает сертификат из хранилища
  5. Пользователь выбирает сертификат и вводит PIN-код
  6. Система формирует подпись в формате CAdES-BES
  7. Система сохраняет подпись и обновляет статус документа
  8. Пользователю отображается сообщение об успешном подписании

  **Альтернативный сценарий А1:** Сертификат не найден
  - На шаге 4, если сертификат не найден, система отображает сообщение "Сертификат не найден"
  - Пользователю предлагается установить сертификат

  **Альтернативный сценарий А2:** Неверный PIN-код
  - На шаге 5, если PIN-код неверный, система отображает ошибку
  - После 3 неверных попыток сертификат блокируется
:::

## 3.2 Функция проверки подписи

:::function-table{#func-verify}
function: Проверка действительности электронной подписи документа
task: DOC-1235
taskUrl: https://task.example.com/browse/DOC-1235
scenario: |
  **Основной сценарий:**
  1. Пользователь открывает подписанный документ
  2. Пользователь нажимает кнопку "Проверить подпись"
  3. Система выполняет проверку:
     - Целостность подписи
     - Срок действия сертификата
     - Статус отзыва сертификата (OCSP/CRL)
  4. Система отображает результат проверки:
     - **Зелёный** — подпись действительна
     - **Жёлтый** — срок сертификата истёк, но подпись была действительна на момент подписания
     - **Красный** — подпись недействительна

  **Отображаемая информация:**
  - ФИО подписанта
  - Организация
  - Дата и время подписания
  - Серийный номер сертификата
  - Издатель сертификата
:::

## 3.3 Функция массового подписания

:::function-table{#func-batch}
function: Подписание нескольких документов одним действием
task: DOC-1236
taskUrl: https://task.example.com/browse/DOC-1236
scenario: |
  1. Пользователь выбирает несколько документов в списке (checkbox)
  2. Нажимает кнопку "Подписать выбранные"
  3. Система отображает список выбранных документов для подтверждения
  4. Пользователь подтверждает действие
  5. Система последовательно подписывает все документы
  6. Отображается отчёт о результатах:
     - Успешно подписано: N документов
     - Ошибки: M документов (с указанием причин)

  **Ограничения:**
  - Максимум 50 документов за одну операцию
  - Все документы должны быть в статусе "На подписании"
:::

# 4. Изменения в интеграционном взаимодействии

## 4.1 Интеграция с сервисом криптографии

:::changes-table
| Описание функции «Как есть» | Описание функции «Как будет» |
|-----------------------------|------------------------------|
| Интеграция с сервисом криптографии отсутствует | Реализована интеграция по REST API |
| - | Поддержка форматов: CAdES-BES, CAdES-T, CAdES-XLT1 |
| - | Синхронный режим для единичных операций |
| - | Асинхронный режим для массовых операций |
:::

## 4.2 Описание API

Взаимодействие осуществляется по протоколу HTTPS с использованием REST API.

**Endpoint:** `POST /api/v1/sign`

**Параметры запроса:**

| Параметр | Тип | Обязательный | Описание |
|----------|-----|--------------|----------|
| documentId | string | Да | Идентификатор документа |
| certificateId | string | Да | Идентификатор сертификата |
| signatureFormat | string | Нет | Формат подписи (по умолчанию CAdES-BES) |

**Пример ответа:**

```json
{
  "status": "success",
  "signatureId": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2025-01-17T10:30:00Z"
}
```

# 5. Изменения в ролевой модели

## 5.1 Новые роли

| Роль | Описание | Права |
|------|----------|-------|
| Подписант | Пользователь с правом подписания документов | Просмотр, подписание, проверка подписи |
| Администратор ЭП | Управление сертификатами и настройками | Все права + настройка параметров |

## 5.2 Изменения существующих ролей

:::changes-table
| Роль «Как есть» | Роль «Как будет» |
|-----------------|------------------|
| Пользователь: просмотр, создание документов | Пользователь: добавлено право "Запрос на подписание" |
| Руководитель: согласование документов | Руководитель: добавлено право "Подписание за подразделение" |
:::

# 6. Приложения

## 6.1 Макеты интерфейса

Макеты пользовательского интерфейса будут разработаны на этапе проектирования.

## 6.2 Требования к производительности

:::note{type="warning"}
**Требования к производительности:**

- Время подписания одного документа: не более 3 секунд
- Время проверки подписи: не более 2 секунд
- Пропускная способность сервиса: не менее 100 операций в минуту
- Доступность сервиса: 99.9%
:::

## 6.3 Требования к безопасности

1. Все операции с ЭП должны логироваться
2. PIN-код не должен передаваться в открытом виде
3. Закрытый ключ не должен покидать устройство пользователя
4. Сессия пользователя должна автоматически завершаться после 15 минут неактивности
